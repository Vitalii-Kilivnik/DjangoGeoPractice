# GeoDjangoRestTest
## 1. Создать новый проект Django + Django REST Framework. Авторизация и интерфейс администрирования не требуются.    
Проект создан на основе указанной спецификации. Для развертывания можно создать PostGis бд в Postgres. Можно использовать файл geodjango.sql    

~~Базу также можно было выложить на сервер, однако деплой в целом в сделку не входил.~~ Тем не менее для удобства, пустая тестовая бд была выгружена в .sql скрипт
Вторым вариантом является создать пустой экземпляр вручную PostGis базы, в таком случае необходимо будет заменить параметры подключения в settings.py. Также для удобства был сделан скрипт для заполнения пустой базы, запускается из python GeoBack\create_buildings.py корневой директории проекта, но при запущенном сервере.
### Как запустить
```
Заходим в корневую папку проекта     
cd GeoDjangoRestTest

Устанавливаем зависимости    
pip install -r requirements.txt

Подготовка и запуск     
cd GeoBack     
python manage.py migrate     
python manage.py createsuperuser     
python manage.py runserver
```

Заполняем базу руками или скриптом `python create_buildings.py`


## 2. Добавить в проект приложение с моделью Building, описывающую географическое положение и адрес строения. Требуются следующие поля:   
   - id  - целочисленный первичный ключ с автоинкрементом;
   - geom - полигональная геометрия в системе координат WGS84 (EPSG:4326);
   - address - текстовая строка для хранения почтового адреса строения.


Модель создана.

## 3. Реализовать REST API для CRUD на базе ModelViewSet, позволяющий создавать,   изменять, удалять и получать записи таблицы building. Должен поддерживаться формат пространственных данных GeoJSON (RFC 7946). При обращении к элементам коллекции по id (методы GET, POST, UPDATE) долже н передаваться или возвращаться объект типа Feature, при обращении к коллекции в целом (метод GET) - объект FeatureCollection из спецификации GeoJSON. Пагинация результатов не требуется.

Список всех обьектов модели доступен по адресу http://127.0.0.1:8000/api/buildings/
Для обращения к конкретному элементу в конце нужно дописать номер нужного.

## 4. Добавить валидатор, проверяющий геометрию объекта на валидность при добавлении или изменении записи.
Валидатор добавлен в аргумент поля geom, сделан на основе GEOSGeometry.valid   
При некорректных данных выдает ValidationError с GEOSGeometry.valid_reason внутри    


Реализация двух фильтров в views.py
## 5. Добавить фильтр, позволяющий отфильтровывать возвращаемые геометрические объекты в зависимости от их площади. Фильтр должен принимать в параметрах GET-запроса значение минимальной и (или) максимальной площади полигона в квадратных метрах.
Был реализован свой фильтр AreaFilterQueryset() на основе BaseFilterBackend. Если в теле запроса были встречены ключевые слова min и(или) max, то в get_queryset
с помощью аннотации добавляем временный столбец с копией геометрии из geom, но трансформированной в другой srid, где вычисление площади производится в метрах. Затем queryset фильтруется по GEOSGeometry.area обьекта из временного столбца.
Примеры корректных обращений 
- http://127.0.0.1:8000/api/buildings/?min=0&max=100000000000
- http://127.0.0.1:8000/api/buildings/?min=0
- http://127.0.0.1:8000/api/buildings/?max=0

## 6. Добавить фильтр, позволяющий отфильтровывать возвращаемые геометрические объекты в зависимости от их расстояния от заданной точки. Фильтр должен принимать в параметрах GET запроса координаты точки (долготу и широту в системе координат WGS84) и максимальное расстояние в метрах. Должны возвращаться объекты, попадающие в заданный радиус полностью или частично.
Фильтрация основана на rest_framework_gis.filters.DistanceToPointFilter
с использование аргумента distance_filter_convert_meters = True,
так как по условию расстояние задается в метрах

http://127.0.0.1:8000/api/buildings/?dist=1000000&point=-2.0,-2.0


## 7. Добавить в проект тесты, проверяющие правильность работы фильтров.     
В GeoBack\TestTask\tests реализованы тесты для pytest. Каждому фильтру соответствует свой файл. В них проверяется корректность работы фильтров на различных корректных и некорректных значениях и отказоустойчивость при подаче неверных данных. Для удобства тестирования при ошибочных значениях в min, max фильтра по площади (например, букв) выдается  HTTP 400 Bad Request    

#### Запустить тесты можно из корневой директории проекта командой `pytest`    

### Тестируются:
- Крайние значения 
- Опечтки
- Пустые значения
- Правильность работы фильтров на корректных значения

